name: Governance Guarantees

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  governance-guarantees:
    name: Verify Governance Signals
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - uses: actions/checkout@v4

      - name: Verify public governance stub exists
        run: |
          if [ ! -f governance/GOVERNANCE.md ]; then
            echo "::error::Public governance stub missing"
            exit 1
          fi
          echo "✅ Governance stub present"

      - name: Verify no CRLF line endings
        run: |
          if grep -rIl $'\r' --include="*.rs" --include="*.md" --include="*.toml" --include="*.yml" --include="*.yaml" --include="*.json" . 2>/dev/null; then
            echo "::error::CRLF detected — line ending drift"
            exit 1
          fi
          echo "✅ Line endings OK (LF only)"

      - name: Verify stability baseline exists
        run: |
          if [ ! -f audits/stability_v1.0.0/repo_manifest.sha256 ]; then
            echo "::error::Stability baseline manifest missing"
            exit 1
          fi
          echo "✅ Stability baseline v1.0.0 present"

